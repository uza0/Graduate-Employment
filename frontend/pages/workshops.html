<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workshops - JoinWork</title>
    <link rel="stylesheet" href="../css/main.css">
    <style>
        .workshops-header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            color: var(--color-text-inverse);
            padding: var(--spacing-2xl) 0;
            margin-bottom: var(--spacing-2xl);
            transition: background var(--transition-base);
        }
        .workshop-card {
            margin-bottom: var(--spacing-lg);
            transition: transform var(--transition-base);
        }
        .workshop-card:hover {
            transform: translateY(-4px);
        }
        .workshop-category {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--color-secondary);
            color: var(--color-text-primary);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--spacing-sm);
        }
        .workshop-date {
            color: var(--color-primary);
            font-weight: var(--font-weight-medium);
            margin: var(--spacing-sm) 0;
        }
    </style>
</head>
<body>
    <!-- Dark Mode Toggle Button -->
    <button id="dark-mode-toggle" class="btn btn-outline btn-sm" onclick="toggleDarkMode()" title="Toggle Dark Mode ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†" style="position: fixed; top: 20px; right: 20px; z-index: 1000; background: var(--color-surface); border: 2px solid var(--color-primary);">
        <span id="dark-mode-icon">ğŸŒ™</span>
    </button>

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="dashboard.html" class="header-logo">JoinWork</a>
            <nav class="header-nav">
                <a href="jobs.html">Jobs Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</a>
                <a href="workshops.html">Workshops ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„</a>
                <a href="profile.html">Profile Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
            </nav>
            <div class="header-user">
                <span id="user-name"></span>
                <button class="btn btn-outline btn-sm" onclick="authAPI.logout()">Logout ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>
    </header>

    <!-- Workshops Header -->
    <div class="workshops-header">
        <div class="container">
            <h1>Training Workshops ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h1>
            <p>Enhance your skills with professional training<br>Ø·ÙˆØ± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø¨Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container page-container">
        <!-- Filters -->
        <div class="filters-section" style="background: var(--color-surface); padding: var(--spacing-lg); border-radius: var(--radius-lg); box-shadow: var(--shadow-md); margin-bottom: var(--spacing-xl);">
            <div class="filters-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md);">
                <div class="form-group">
                    <label for="filter-category" class="form-label">Category Ø§Ù„ÙØ¦Ø©</label>
                    <select id="filter-category" class="form-select" onchange="filterWorkshops()">
                        <option value="">All Categories Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                        <option value="Technology">Technology Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option>
                        <option value="Business">Business Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</option>
                        <option value="Design">Design Ø§Ù„ØªØµÙ…ÙŠÙ…</option>
                        <option value="Marketing">Marketing Ø§Ù„ØªØ³ÙˆÙŠÙ‚</option>
                        <option value="Other">Other Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="search-workshops" class="form-label">Search Ø¨Ø­Ø«</label>
                    <input 
                        type="text" 
                        id="search-workshops" 
                        class="form-input" 
                        placeholder="Search workshops... Ø§Ø¨Ø­Ø« Ø¹Ù† ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„..."
                        onkeyup="filterWorkshops()"
                    >
                </div>
            </div>
        </div>

        <!-- Workshops List -->
        <div id="workshops-container">
            <div class="empty-state">
                <p>Loading workshops... Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„...</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>JoinWork</h4>
                    <p>Connecting graduates with opportunities<br>Ø±Ø¨Ø· Ø§Ù„Ø®Ø±ÙŠØ¬ÙŠÙ† Ø¨Ø§Ù„ÙØ±Øµ</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h4>
                    <a href="jobs.html">Jobs Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</a>
                    <a href="workshops.html">Workshops ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„</a>
                    <a href="profile.html">Profile Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 JoinWork. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="../js/firebase-config.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        let allWorkshops = [];
        let filteredWorkshops = [];

        // Check authentication
        if (!isAuthenticated()) {
            window.location.href = 'login.html';
        }

        // Load user data
        const userData = getCurrentUser();
        if (userData) {
            document.getElementById('user-name').textContent = userData.full_name || userData.email;
        }

        // Load workshops
        async function loadWorkshops() {
            try {
                const response = await workshopsAPI.getAll();
                allWorkshops = response.workshops || [];
                filteredWorkshops = [...allWorkshops];
                displayWorkshops();
            } catch (error) {
                console.error('Error loading workshops:', error);
                document.getElementById('workshops-container').innerHTML = `
                    <div class="alert alert-error">
                        <strong>Error: Ø®Ø·Ø£:</strong> Failed to load workshops. Please try again later.<br>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.
                    </div>
                `;
            }
        }

        // Filter workshops
        function filterWorkshops() {
            const categoryFilter = document.getElementById('filter-category').value.toLowerCase();
            const searchTerm = document.getElementById('search-workshops').value.toLowerCase();

            filteredWorkshops = allWorkshops.filter(workshop => {
                const matchesCategory = !categoryFilter || 
                    (workshop.category && workshop.category.toLowerCase() === categoryFilter);

                const matchesSearch = !searchTerm || 
                    (workshop.title && workshop.title.toLowerCase().includes(searchTerm)) ||
                    (workshop.description && workshop.description.toLowerCase().includes(searchTerm)) ||
                    (workshop.trainer && workshop.trainer.toLowerCase().includes(searchTerm));

                return matchesCategory && matchesSearch;
            });

            displayWorkshops();
        }

        // Display workshops
        function displayWorkshops() {
            const container = document.getElementById('workshops-container');

            if (filteredWorkshops.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>No workshops found matching your criteria.<br>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙˆØ±Ø´ Ø¹Ù…Ù„ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ±Ùƒ.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredWorkshops.map(workshop => `
                <div class="card workshop-card">
                    ${workshop.category ? `<span class="workshop-category">${workshop.category}</span>` : ''}
                    <h3 class="card-title">${workshop.title || 'Workshop'}</h3>
                    ${workshop.date ? `<div class="workshop-date">ğŸ“… ${formatDateTime(workshop.date)}</div>` : ''}
                    ${workshop.trainer ? `<p><strong>Trainer Ø§Ù„Ù…Ø¯Ø±Ø¨:</strong> ${workshop.trainer}</p>` : ''}
                    ${workshop.duration ? `<p><strong>Duration Ø§Ù„Ù…Ø¯Ø©:</strong> ${workshop.duration} minutes Ø¯Ù‚Ø§Ø¦Ù‚</p>` : ''}
                    ${workshop.max_participants ? `<p><strong>Max Participants Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†:</strong> ${workshop.max_participants}</p>` : ''}
                    ${workshop.description ? `
                        <div class="card-body" style="margin-top: var(--spacing-md);">
                            ${truncateText(workshop.description, 200)}
                        </div>
                    ` : ''}
                    <div class="card-footer">
                        <button class="btn btn-primary" onclick="registerForWorkshop(${workshop.workshop_id})">Join Workshop Ø§Ù†Ø¶Ù… Ù„Ù„ÙˆØ±Ø´Ø©</button>
                    </div>
                </div>
            `).join('');
        }

        // Register for workshop
        async function registerForWorkshop(workshopId) {
            if (!confirm('Are you sure you want to register for this workshop?\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ±Ø´Ø©ØŸ')) {
                return;
            }

            try {
                await workshopsAPI.register(workshopId);
                alert('Successfully registered for the workshop!\nØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                alert('Failed to register: ' + (error.message || 'Unknown error') + '\nÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + (error.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initDarkMode();
            loadWorkshops();
        });
    </script>
</body>
</html>

